{"remainingRequest":"/Volumes/LMQ/Downloads/PM/my/myproject/appfront/node_modules/vue-loader/lib/index.js??vue-loader-options!/Volumes/LMQ/Downloads/PM/my/myproject/appfront/src/components/wechat/msgitem.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Volumes/LMQ/Downloads/PM/my/myproject/appfront/src/components/wechat/msgitem.vue","mtime":1608703131000},{"path":"/Volumes/LMQ/Downloads/PM/my/myproject/appfront/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Volumes/LMQ/Downloads/PM/my/myproject/appfront/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Volumes/LMQ/Downloads/PM/my/myproject/appfront/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Volumes/LMQ/Downloads/PM/my/myproject/appfront/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmV4cG9ydCBkZWZhdWx0IHsKICAgIHByb3BzOiBbIml0ZW0iXSwKICAgIGRhdGEoKSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgcmVhZDogdGhpcy5pdGVtLnJlYWQsCiAgICAgICAgICAgIGRlbGV0ZU1zZzogZmFsc2UKICAgICAgICB9CiAgICB9LAogICAgbWV0aG9kczogewogICAgICAgIC8v5YiH5o2i5raI5oGv5pyq6K+7L+W3suivu+eKtuaAgQogICAgICAgIHRvZ2dsZU1zZ1JlYWQoZXZlbnQsIHN0YXR1cykgewogICAgICAgICAgICBpZiAoc3RhdHVzID09PSAnZW50ZXInKSB7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5yZWFkKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICcnCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0aGlzLnJlYWQgPSB0cnVlCiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0aGlzLnJlYWQgPSAhdGhpcy5yZWFkCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKCF0aGlzLml0ZW0ucXVpZXQpIHsKICAgICAgICAgICAgICAgIGlmICh0aGlzLnJlYWQpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLiRzdG9yZS5jb21taXQoJ21pbnVzTmV3TXNnJykKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy4kc3RvcmUuY29tbWl0KCdhZGROZXdNc2cnKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBldmVudC50YXJnZXQucGFyZW50Tm9kZS5wYXJlbnROb2RlLmZpcnN0Q2hpbGQuc3R5bGUubWFyZ2luTGVmdCA9IDAgKyAicHgiCiAgICAgICAgfSwKICAgICAgICBkZWxldGVNc2dFdmVudCgpIHsKICAgICAgICAgICAgdGhpcy5kZWxldGVNc2cgPSB0cnVlCiAgICAgICAgICAgIGlmICghdGhpcy5pdGVtLnF1aWV0KSB7CiAgICAgICAgICAgICAgICBpZiAoIXRoaXMucmVhZCkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuJHN0b3JlLmNvbW1pdCgnbWludXNOZXdNc2cnKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSwKICAgIC8vIOWPguiAgyBodHRwczovL3Z1ZWZlLmNuL3YyL2d1aWRlL2N1c3RvbS1kaXJlY3RpdmUuaHRtbAogICAgZGlyZWN0aXZlczogewogICAgICAgIHN3aXBlcjogewogICAgICAgICAgICBiaW5kOiBmdW5jdGlvbiAoZWxlbWVudCkgewogICAgICAgICAgICAgICAgdmFyIGlzVG91Y2hNb3ZlLCBzdGFydFR4LCBzdGFydFR5CiAgICAgICAgICAgICAgICBlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNoc3RhcnQnLCBmdW5jdGlvbiAoZSkgewogICAgICAgICAgICAgICAgICAgIHZhciB0b3VjaGVzID0gZS50b3VjaGVzWzBdCiAgICAgICAgICAgICAgICAgICAgc3RhcnRUeCA9IHRvdWNoZXMuY2xpZW50WAogICAgICAgICAgICAgICAgICAgIHN0YXJ0VHkgPSB0b3VjaGVzLmNsaWVudFkKICAgICAgICAgICAgICAgICAgICBpc1RvdWNoTW92ZSA9IGZhbHNlOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNobW92ZScsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICAgICAgICAgIHZhciB0b3VjaGVzID0gZS5jaGFuZ2VkVG91Y2hlc1swXSwKICAgICAgICAgICAgICAgICAgICAgICAgZW5kVHggPSB0b3VjaGVzLmNsaWVudFgsCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZFR5ID0gdG91Y2hlcy5jbGllbnRZLAogICAgICAgICAgICAgICAgICAgICAgICBkaXN0YW5jZVggPSBzdGFydFR4IC0gZW5kVHgsCiAgICAgICAgICAgICAgICAgICAgICAgIGRpc3RhbmNlWSA9IHN0YXJ0VHkgLSBlbmRUeTsKICAgICAgICAgICAgICAgICAgICBpZiAoZGlzdGFuY2VYIDwgMCkgeyAvL+WPs+a7kQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoTWF0aC5hYnMoZGlzdGFuY2VYKSA+PSBNYXRoLmFicyhkaXN0YW5jZVkpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoTWF0aC5hYnMoZGlzdGFuY2VYKSA+IDIwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5zdHlsZS50cmFuc2l0aW9uID0gIjAuM3MiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5zdHlsZS5tYXJnaW5MZWZ0ID0gMCArICJweCIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7IC8v5bem5ruRCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChNYXRoLmFicyhkaXN0YW5jZVgpID49IE1hdGguYWJzKGRpc3RhbmNlWSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkaXN0YW5jZVggPCAxNTYgJiYgZGlzdGFuY2VYID4gMjApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50LnN0eWxlLnRyYW5zaXRpb24gPSAiMHMiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5zdHlsZS5tYXJnaW5MZWZ0ID0gLWRpc3RhbmNlWCArICJweCIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpc1RvdWNoTW92ZSA9IHRydWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sIHsgcGFzc2l2ZTogZmFsc2UgfSk7CiAgICAgICAgICAgICAgICBlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNoZW5kJywgZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoIWlzVG91Y2hNb3ZlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgdmFyIHRvdWNoZXMgPSBlLmNoYW5nZWRUb3VjaGVzWzBdLAogICAgICAgICAgICAgICAgICAgICAgICBlbmRUeCA9IHRvdWNoZXMuY2xpZW50WCwKICAgICAgICAgICAgICAgICAgICAgICAgZW5kVHkgPSB0b3VjaGVzLmNsaWVudFksCiAgICAgICAgICAgICAgICAgICAgICAgIGRpc3RhbmNlWCA9IHN0YXJ0VHggLSBlbmRUeCwKICAgICAgICAgICAgICAgICAgICAgICAgZGlzdGFuY2VZID0gc3RhcnRUeSAtIGVuZFR5CiAgICAgICAgICAgICAgICAgICAgLy8gaXNTd2lwZSA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgaWYgKE1hdGguYWJzKGRpc3RhbmNlWCkgPj0gTWF0aC5hYnMoZGlzdGFuY2VZKSkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGlzdGFuY2VYIDwgMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChNYXRoLmFicyhkaXN0YW5jZVgpIDwgNjApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGlzU3dpcGUgPSB0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50LnN0eWxlLnRyYW5zaXRpb24gPSAiMC4zcyIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuc3R5bGUubWFyZ2luTGVmdCA9IDAgKyAicHgiCiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50LnN0eWxlLnRyYW5zaXRpb24gPSAiMC4zcyIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuc3R5bGUubWFyZ2luTGVmdCA9ICItMTU2cHgiCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KfQo="},{"version":3,"sources":["msgitem.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAwCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"msgitem.vue","sourceRoot":"src/components/wechat","sourcesContent":["<template>\n    <!--消息列表组件 数据交互频繁-->\n    <!--进入 dialogue 页面，携带参数 mid name group_num -->\n    <li :class=\"{'item-hide':deleteMsg}\">\n        <!--自定义指令 v-swiper 用于对每个消息进行滑动处理-->\n        <router-link\n            :to=\"{ path: '/wechat/dialogue', query: { mid: item.mid,name:item.group_name||(item.user[0].remark||item.user[0].nickname),group_num:item.user.length}}\"\n            tag=\"div\" class=\"list-info\" v-swiper v-on:click.native=\"toggleMsgRead($event,'enter')\">\n            <div class=\"header-box\">\n                <!--未读并且未屏蔽 才显示新信息数量-->\n                <i class=\"new-msg-count\" v-show=\"!read&&!item.quiet\">{{item.msg.length}}</i>\n                <!--未读并且屏蔽 只显示小红点-->\n                <i class=\"new-msg-dot\" v-show=\"!read&&item.quiet\"></i>\n                <!--如果是私聊，只显示一个头像； 如果是群聊，则显示多个头像，flex 控制样式-->\n                <div class=\"header\" :class=\"[item.type=='group'?'multi-header':'']\">\n                    <img v-for=\"(userInfo,index) in item.user\" :key=\"index\" :src=\"userInfo.headerUrl\">\n                </div>\n            </div>\n            <div class=\"desc-box\">\n                <!--使用过滤器 fmtDate 格式化时间-->\n                <div class=\"desc-time\">{{item.msg[item.msg.length-1].date | fmtDate('hh:ss')}}</div>\n                <div class=\"desc-author\" v-if=\"item.type=='group'\">{{item.group_name}}</div>\n                <!--如果没有备注好友，则显示微信昵称-->\n                <div class=\"desc-author\" v-else>{{item.user[0].remark||item.user[0].nickname}}</div>\n                <div class=\"desc-msg\">\n                    <div class=\"desc-mute iconfont icon-mute\" v-show=\"item.quiet\">\n                    </div>\n                    <span v-show=\"item.type=='group'\">{{item.msg[item.msg.length-1].name}}:</span>\n                    <span>{{item.msg[item.msg.length-1].text}}</span>\n                </div>\n            </div>\n        </router-link>\n        <div class=\"operate-box\">\n            <div class=\"operate-unread\" v-if=\"read\" v-on:click=\"toggleMsgRead\">标为未读</div>\n            <div class=\"operate-read\" v-else v-on:click=\"toggleMsgRead\">标为已读</div>\n            <div class=\"operate-del\" v-on:click=\"deleteMsgEvent\">删除</div>\n        </div>\n    </li>\n</template>\n<script>\n    export default {\n        props: [\"item\"],\n        data() {\n            return {\n                read: this.item.read,\n                deleteMsg: false\n            }\n        },\n        methods: {\n            //切换消息未读/已读状态\n            toggleMsgRead(event, status) {\n                if (status === 'enter') {\n                    if (this.read) {\n                        return ''\n                    }\n                    this.read = true\n                } else {\n                    this.read = !this.read\n                }\n                if (!this.item.quiet) {\n                    if (this.read) {\n                        this.$store.commit('minusNewMsg')\n                    } else {\n                        this.$store.commit('addNewMsg')\n                    }\n                }\n\n                event.target.parentNode.parentNode.firstChild.style.marginLeft = 0 + \"px\"\n            },\n            deleteMsgEvent() {\n                this.deleteMsg = true\n                if (!this.item.quiet) {\n                    if (!this.read) {\n                        this.$store.commit('minusNewMsg')\n                    }\n                }\n            }\n        },\n        // 参考 https://vuefe.cn/v2/guide/custom-directive.html\n        directives: {\n            swiper: {\n                bind: function (element) {\n                    var isTouchMove, startTx, startTy\n                    element.addEventListener('touchstart', function (e) {\n                        var touches = e.touches[0]\n                        startTx = touches.clientX\n                        startTy = touches.clientY\n                        isTouchMove = false;\n                    });\n                    element.addEventListener('touchmove', function (e) {\n                        e.preventDefault();\n                        var touches = e.changedTouches[0],\n                            endTx = touches.clientX,\n                            endTy = touches.clientY,\n                            distanceX = startTx - endTx,\n                            distanceY = startTy - endTy;\n                        if (distanceX < 0) { //右滑\n                            if (Math.abs(distanceX) >= Math.abs(distanceY)) {\n                                if (Math.abs(distanceX) > 20) {\n                                    element.style.transition = \"0.3s\"\n                                    element.style.marginLeft = 0 + \"px\"\n                                }\n                            }\n                        } else { //左滑\n                            if (Math.abs(distanceX) >= Math.abs(distanceY)) {\n                                if (distanceX < 156 && distanceX > 20) {\n                                    element.style.transition = \"0s\"\n                                    element.style.marginLeft = -distanceX + \"px\"\n                                    isTouchMove = true\n                                }\n                            }\n                        }\n                    }, { passive: false });\n                    element.addEventListener('touchend', function (e) {\n                        if (!isTouchMove) {\n                            return;\n                        }\n                        var touches = e.changedTouches[0],\n                            endTx = touches.clientX,\n                            endTy = touches.clientY,\n                            distanceX = startTx - endTx,\n                            distanceY = startTy - endTy\n                        // isSwipe = false\n                        if (Math.abs(distanceX) >= Math.abs(distanceY)) {\n                            if (distanceX < 0) {\n                                return;\n                            }\n                            if (Math.abs(distanceX) < 60) {\n                                // isSwipe = true\n                                element.style.transition = \"0.3s\"\n                                element.style.marginLeft = 0 + \"px\"\n                            } else {\n                                element.style.transition = \"0.3s\"\n                                element.style.marginLeft = \"-156px\"\n                            }\n                        }\n                    });\n                }\n            }\n        }\n    }\n</script>"]}]}